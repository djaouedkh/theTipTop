generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int                @id @default(autoincrement()) @map("id")
  firstname         String             @map("firstname")
  lastname          String             @map("lastname")
  email             String             @unique @map("email")
  password          String             @map("password")
  gender            String             @map("gender")
  age               Int                @map("age")
  createdAt         DateTime           @default(now()) @map("created_at")
  roleId            Int                @map("role_id")
  role              Role               @relation(fields: [roleId], references: [id])
  tickets           Ticket[]
  lotteryGames      LotteryGame[]
  userEmails        UserEmail[]

  @@map("user")
}

model UserEmail {
  id          Int      @id @default(autoincrement()) @map("id")
  userId      Int      @map("user_id")
  emailId     Int      @map("email_id")
  user        User     @relation(fields: [userId], references: [id])
  email       Email    @relation(fields: [emailId], references: [id])
  userEmail   String   @map("user_email")

  @@map("user_email")
  @@unique([userId, emailId])
}

model Email {
  id          Int          @id @default(autoincrement()) @map("id")
  subject     String       @map("subject")
  body        String       @map("body")
  status      String       @map("status")
  createdAt   DateTime     @default(now()) @map("created_at")
  userEmails  UserEmail[]

  @@map("email")
}


model Role {
  id    Int    @id @default(autoincrement()) @map("id")
  name  String @unique @map("name")
  users User[]

  @@map("role")
}

model Ticket {
  id           Int      @id @default(autoincrement()) @map("id")
  code          String   @unique @map("code")
  isDelivered     Boolean  @default(false) @map("is_delivered")
  createdAt   DateTime @default(now()) @map("created_at")
  userId      Int?      @map("user_id")
  user        User?     @relation(fields: [userId], references: [id])
  gainId      Int     @map("gain_id")
  gain        Gain   @relation(fields: [gainId], references: [id])
  gainDelivery GainDelivery?
  contestId      Int     @map("contest_id")
  contest        Contest   @relation(fields: [contestId], references: [id])

  @@map("ticket")
}

model Gain {
  id           Int       @id @default(autoincrement()) @map("id")
  name         String    @map("name")
  desc         String    @map("description")
  price        Float     @map("price")
  tickets      Ticket[]

  @@map("gain")
}

model GainDelivery {
  id          Int      @id @default(autoincrement()) @map("id")
  deliveryDate DateTime @map("delivery_date")
  ticketId    Int      @unique @map("ticket_id")
  ticket      Ticket   @relation(fields: [ticketId], references: [id])
  storeId     Int?     @map("store_id")
  store       Store?   @relation(fields: [storeId], references: [id])

  @@map("gain_delivery")
}

model Store {
  id          Int      @id @default(autoincrement()) @map("id")
  name        String   @map("name")
  address     String   @map("address")
  city        String   @map("city")
  postalCode  String   @map("postal_code")
  gainDeliveries GainDelivery[]

  @@map("store")
}

model Contest {
  id          Int      @id @default(autoincrement()) @map("id")
  name        String   @map("name")
  startDate   DateTime @map("start_date")
  endDate     DateTime @map("end_date")
  tickets       Ticket[]

  @@map("contest")
}

model LotteryGame {
  id          Int      @id @default(autoincrement()) @map("id")
  name        String   @map("name")
  playDate    DateTime? @map("play_date")
  userId      Int?      @map("user_id")
  user        User?     @relation(fields: [userId], references: [id])

  @@map("lottery_game")
}
