generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int                @id @default(autoincrement()) @map("id")
  firstname         String             @map("firstname")
  lastname          String             @map("lastname")
  email             String             @unique @map("email")
  password          String             @map("password")
  createdAt         DateTime           @default(now()) @map("created_at")
  tickets           Ticket[]           // Relation avec les tickets achetés
  roleId            Int                @map("role_id") // Référence à un rôle unique
  role              Role               @relation(fields: [roleId], references: [id])
  prizeDistributions PrizeDistribution[] // Relation inverse avec PrizeDistribution
  
  @@map("user")
}


model Role {
  id    Int    @id @default(autoincrement()) @map("id")
  name  String @unique @map("name")
  users User[]

  @@map("role")
}

model Ticket {
  id           Int      @id @default(autoincrement()) @map("id")
  ref          String   @unique @map("ref")
  status       Boolean  @default(false) @map("status")
  issuedDate   DateTime @default(now()) @map("issued_date")
  userId       Int?      @map("user_id")
  user         User?     @relation(fields: [userId], references: [id])
  prizeId      Int     @map("prize_id")
  prize        Prize   @relation(fields: [prizeId], references: [id])
  contestId      Int     @map("contest_id")
  event        Contest   @relation(fields: [contestId], references: [id])

  @@map("ticket")
}

// Table Lot (Prize)
model Prize {
  id           Int       @id @default(autoincrement()) @map("id")
  name         String    @map("name")
  desc         String    @map("description")
  type         String    @map("type")
  price        Float     @map("price")
  tickets      Ticket[]
  distributions PrizeDistribution[]

  @@map("prize")
}

model PrizeDistribution {
  id          Int      @id @default(autoincrement()) @map("id")
  isClaimed   Boolean  @default(false) @map("is_claimed")
  dateClaimed DateTime? @map("date_claimed")
  prizeId     Int      @map("prize_id")
  prize       Prize    @relation(fields: [prizeId], references: [id])
  userId      Int      @map("user_id")
  user        User     @relation(fields: [userId], references: [id])
  storeId     Int?     @map("store_id")
  store       Store?   @relation(fields: [storeId], references: [id])

  @@map("prize_distribution")
}

model Store {
  id          Int      @id @default(autoincrement()) @map("id")
  name        String   @map("name")
  address     String   @map("address")
  city        String   @map("city")
  postalCode  String   @map("postal_code")
  distributions PrizeDistribution[]

  @@map("store")
}

model Contest {
  id          Int      @id @default(autoincrement()) @map("id")
  name        String   @map("name")
  startDate   DateTime @map("start_date")
  endDate     DateTime @map("end_date")
  tickets       Ticket[]

  @@map("contest")
}
